<!DOCTYPE html>
<html lang="es">
<head>
    {% load humanize %}
    <meta charset="UTF-8">
    <title>Remisiones por Cliente</title>
    <style>
        body {
        font-family: sans-serif;
        font-size: 12px;
        }
        h2, h3 {
        margin: 0;
        }
        table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        }
        th, td {
        border-bottom: 1px solid #ccc;
        padding: 4px;
        text-align: left;
        }
        .encabezado {
        margin-bottom: 10px;
        }
        .separador {
        border-top: 2px solid black;
        border-bottom: 2px solid black;
        margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="print-area">
        <div class="encabezado">
            <h2>BIT•SISTEMAS</h2>

            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;">REMISIONES POR CLIENTE</h3>
                <span>Fecha: {{ fecha_actual }}</span>
            </div>

            <p>CLIENTE: {{ cliente.cliente }}   {{ cliente.nombre }}</p>
        </div>

        <div class="separador"></div>

        <table>
            <thead>
            <tr>
                <th>FECHA</th>
                <th>REMISIÓN</th>
                <th>PRODUCTO</th>
                <th style="text-align: right;">CANTIDAD</th>
                <th style="text-align: right;">PRECIO</th>
                <th style="text-align: right;">DESCUENTO</th>
                <th style="text-align: right;">TOTAL</th>
            </tr>
            </thead>
            <tbody>
            {% for detalle in detalles %}
                <tr>
                    <td style="font-size: 0.8em; letter-spacing: -0.5px;">
                        {{ detalle.numero_remision.fecha_remision|date:"d/M/Y"|upper }} 
                
                    <td style="font-size: 0.8em; letter-spacing: -0.5px;">{{ detalle.numero_remision.numero_remision }}</td>
                    <td style="font-size: 0.8em; letter-spacing: -0.5px;">{{ detalle.producto.descripcion }}</td>
                    <td style="text-align: right; font-size: 0.8em; letter-spacing: -0.5px;">{{ detalle.cantidad|default_if_none:0|floatformat:2|intcomma }}</td>
                    <td style="text-align: right; font-size: 0.8em; letter-spacing: -0.5px;">{{ detalle.precio|default_if_none:0|floatformat:2|intcomma }}</td>
                    <td style="text-align: right; font-size: 0.8em; letter-spacing: -0.5px;">{{ detalle.descuento|default_if_none:0|floatformat:2|intcomma }}</td>
                    <td style="text-align: right; font-size: 0.8em; letter-spacing: -0.5px;">{{ detalle.subtotal|default_if_none:0|floatformat:2|intcomma }}</td>
                </tr>
            {% endfor %}
            </tbody>
            <div class="total-general">
                <tr>
                    <td colspan="6" style="text-align:right;"><strong>TOTAL GENERAL</strong></td>
                    
                    <td style="text-align:right; font-size: 0.8em; letter-spacing: -0.5px;"><strong>{{ total_general|default_if_none:0|floatformat:2|intcomma }}</strong></td>
                </tr>
            </div>
        </table>
    </div>
    <button onclick="printSection('print-area')" class="btn btn-primary no-print">
        Imprimir
    </button>
    
    <script>
        function printSection(id) {
        const content = document.getElementById(id).innerHTML;
        const printWindow = window.open('', '', 'height=600,width=800');
        printWindow.document.write('<html><head><title>Impresión</title>');
        printWindow.document.write(`
            <style>
                body { font-family: sans-serif; font-size: 11px; }
                table {
                    border-collapse: collapse;
                    width: 100%;
                    page-break-after: avoid; /* evita que la tabla se rompa innecesariamente */
                }
                thead tr {
                    border-top: 2px solid black;
                    border-bottom: 2px solid black;
                }
                thead th {
                    padding: 4px;
                    text-align: left;
                    font-size: 11px;
                }
                td {
                    padding: 2px;
                }
                table, td {
                    border: none !important;
                }
                .total-general {
                    page-break-before: auto;  /* <- NO fuerza salto */
                    page-break-inside: avoid; /* evita que se corte el bloque */
                    margin-top: 20px;
                    font-size: 14px;
                    font-weight: bold;
                }
            </style>
        `);
        printWindow.document.write('</head><body>');
        printWindow.document.write(content);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.print();
        }
    </script>
</body>

</html>
